//
//  UIWebView+MDF.m
//  JDBClient
//
//  Created by You Tu on 15/3/3.
//  Copyright (c) 2015年 JDB. All rights reserved.
//

#import "UIWebView+MDF.h"

@implementation UIWebView (MDF)

- (void)loadLocalHtmlWithName:(NSString *)name
{
    NSString *path = [[NSBundle mainBundle] pathForResource:name ofType:@"html"];
    if (path) {
        NSURL *pathUrl = [NSURL fileURLWithPath:path];
        [self loadRequest:[NSURLRequest requestWithURL:pathUrl]];
    }
}

- (void)clearCache
{
    // cancel
    [[NSURLCache sharedURLCache] removeAllCachedResponses];
    
    [[NSURLCache sharedURLCache] setMemoryCapacity:0];
    
    // clear all cookies
    for(NSHTTPCookie *cookie in [[NSHTTPCookieStorage sharedHTTPCookieStorage] cookies]) {
        [[NSHTTPCookieStorage sharedHTTPCookieStorage] deleteCookie:cookie];
    }
}

- (void)cleanForDealloc
{
    [self stopLoading];
    self.delegate = nil;
    
    [self stringByEvaluatingJavaScriptFromString:@"document.body.innerHTML = \"\";"];
    [[NSUserDefaults standardUserDefaults] setInteger:0 forKey:@"WebKitCacheModelPreferenceKey"];
    [self stringByEvaluatingJavaScriptFromString:@"var body=document.getElementsByTagName('body')[0];body.style.backgroundColor=(body.style.backgroundColor=='')?'white':'';"];
}

- (void)clear
{
    [self loadHTMLString: @"" baseURL: nil]; //防止页面加载中返回crash，在返回时加载一个空页面，取消当前的Url请求
    [self cleanForDealloc];
    [self clearCache];
    self.delegate = nil;
}

@end
